<link rel="import" href="pbe-route.html">
<link rel="import" href="pbe-literal.html">
<link rel="import" href="dao-library.html">

<dom-module id="hello-world">
<template>
  <pbe-route handler="hello-world-handler" path="/hello/:key"></pbe-route>
  <pbe-route handler="save-handler" path="/save/:author/:library/:likes"></pbe-route>
  <pbe-route handler="get-handler" path="/load/:author/:library"></pbe-route>
</template>
<script>
Polymer({
  is: 'hello-world',
  attached: function() { console.log('attached a hello-world'); }
});
</script>
</dom-module>

<dom-module id="save-handler">
<template>
  <pbe-literal contents="{{response}}" after="{{fragmentReady}}">
    Saved library <span>{{data.author}}</span>/<span>{{data.library}}</span> with <span>{{data.likes}}</span> likes
  </pbe-literal>
  <dao-library key="{{makeKey(data.author, data.library)}}" data="{{data}}" autoSave='true' after="{{daoReady}}"></dao-library>
</template>
</dom-module>
<script>
Polymer({
  is: 'save-handler',
  makeKey(a, l) { return `${a}/${l}`; },
  properties: {
    dataReady: { computed: "all(fragmentReady, daoReady)" }
  }, 
  all: function() { return Promise.all(arguments); }
});
</script>
</dom-module>

<dom-module id="get-handler">
<template>
  <pbe-literal contents="{{response}}" await="{{dataStable}}" after="{{dataReady}}">
    Retrieved library <span>{{data.author}}</span>/<span>{{data.library}}</span> with <span>{{data.likes}}</span> likes
  </pbe-literal>
  <dao-library key="{{makeKey(data.author, data.library)}}" data="{{data}}" after="{{dataStable}}" autoLoad='true'></dao-library>
</template>
<script>
Polymer({
  is: 'get-handler',
  makeKey(a, l) { return `${a}/${l}`; },
});
</script>
</dom-module>

<dom-module id="hello-world-handler">
<template>
  <pbe-literal contents="{{response}}" after="{{dataReady}}">
    Hello, <b>{{data.key}}</b> HOW ARE YOU
  </pbe-literal>
</template>
<script>
Polymer({
  is: 'hello-world-handler',
});
</script>
</dom-module>

